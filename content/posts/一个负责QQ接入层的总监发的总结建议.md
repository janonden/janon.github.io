---
title: "一个负责QQ接入层的总监发的总结建议"
date: 2018-11-10T11:21:31+08:00
categories: []
tags: []
---

### 移动客户端消息处理的几点思考

1. 连接使用tcp长连接，消息通道的连接不要断开。富媒体的大数据连接另外建，用时提前建立，延迟3分钟断开。消息轻重分离，文本消息、信令消息通道独立。
2. 获取连接ip直接记录上次使用的ip，连接成功后再更新存储连接ip列表。不要做域名解析。
3. 连接的ip按移动运营商和接入服务器ip，wifi接入点和接入服务器ip配对缓存，使用过程中给这些ip对打分，下次连接时有限尝试分数高的。尝试都失败时，去服务器拉取列表更新。
4. 移动端尝试要快，超时要长。譬如重试方式是请求统一60秒超时，第一个请求发出后3秒没收到应答则发第二个，10秒发第三个，20秒发第四个，以此类推，持续60秒，只有一个发送成功就算请求成功。
5. tcp发送不成功，10秒内使用http短连接尝试。
6. 要能快速判断假连接，那种客户端认为连接可用，实际连接已经断开的情况。如果连续几个请求短时间无应答，快速换ip简历新连接。
7. 消息推拉结合，在线的实时推，不在线刚上来的，客户端主动拉。

### 后台介绍

1. 开放80、8080、443、14000、15000端口
2. TCP长连接和HTTP短连接两种接入方式
   一般情况下终端优先使用tcp长连接，当长连接无法建立，或者数据通道不通的情况下，会使用http短连接（典型的场景是，网络上某些节点对端口和协议有限制）。随着前后端版本的不断演进，终端使用http短连接的场景也越来越多。比如：①终端定期从后台GET最优serverList；②智能设备等第三方APP通过OAuth2.0（开放授权）协议体系接入SSO；③“PCQQ退出时唤醒手Q”新功能，手Q终端定期去后台查询是否需要唤醒；④终端在某些场景下实现“快速回复”功能。
